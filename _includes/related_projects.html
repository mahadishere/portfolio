{% assign current = include.project %}
{% assign related = site.projects | where_exp: "p", "p.url != current.url" %}
{% assign matches = '' | split: '' %}

{% for p in related %}
	{% assign is_related = false %}
	{% if current.domain and p.domain %}
		{% for d in current.domain %}
			{% if p.domain contains d %}
				{% assign is_related = true %}
				{% break %}
			{% endif %}
		{% endfor %}
	{% endif %}
	{% unless is_related %}
		{% if current.project_type and p.project_type %}
			{% for t in current.project_type %}
				{% if p.project_type contains t %}
					{% assign is_related = true %}
					{% break %}
				{% endif %}
			{% endfor %}
		{% endif %}
	{% endunless %}
	{% if is_related %}
		{% assign matches = matches | push: p %}
	{% endif %}
{% endfor %}

{% if matches.size > 0 %}
<section class="related-projects" style="margin-top: 2.5em;">
	<h3 style="text-align: center; margin-bottom: 1.25em;"><u>Related Projects</u></h3>
	<div class="row aln-center">
		{% for p in matches limit: 6 %}
		<div class="col-4" style="margin-bottom: 1.5em;">
			<a href="{{ p.url | relative_url }}" style="text-decoration: none; display: block;">
				<div style="background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.10); border-radius: 12px; overflow: hidden; transition: transform 0.2s ease, box-shadow 0.2s ease;">
					<img loading="lazy"
						 decoding="async"
						 fetchpriority="low"
						 src="{{ p.card_image | relative_url }}"
						 alt="{{ p.title }}"
						 style="width: 100%; height: 180px; object-fit: cover; display: block;">
					<div style="padding: 1em;">
						<h4 style="margin: 0 0 0.5em 0; font-size: 1.1em; color: var(--text-primary);">{{ p.title }}</h4>
						{% if p.summary %}
						<p style="margin: 0; font-size: 0.9em; color: var(--text-muted); line-height: 1.4;">{{ p.summary }}</p>
						{% endif %}
					</div>
				</div>
			</a>
		</div>
		{% endfor %}
	</div>
</section>
{% endif %}

<!-- Browse all projects section: comprehensive project index for link checker compatibility -->
<section class="all-projects-index" style="margin-top: 3em; padding-top: 2em; border-top: 1px solid rgba(255,255,255,0.1);">
	<h3 style="text-align: center; margin-bottom: 1.5em;"><u>Browse All Projects</u></h3>
	<div class="row aln-center">
		<div class="col-10">
			<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5em;">
				{% for p in site.projects %}
				<article style="background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); border-radius: 8px; padding: 1.25em; transition: background 0.2s ease;">
					<h4 style="margin: 0 0 0.5em 0; font-size: 1.05em;">
						<a href="{{ p.url | relative_url }}" style="color: var(--text-primary); text-decoration: none;">{{ p.title }}</a>
						{% if p.featured %}<span style="margin-left: 0.5em; color: #ffd700;">â˜…</span>{% endif %}
					</h4>
					{% if p.summary %}
					<p style="margin: 0 0 0.75em 0; font-size: 0.9em; color: var(--text-secondary); line-height: 1.5;">{{ p.summary }}</p>
					{% endif %}
					<div style="font-size: 0.85em; color: var(--text-muted); margin-bottom: 0.5em;">
						{% if p.platform %}<div style="margin-bottom: 0.25em;"><strong>Platform:</strong> {{ p.platform }}</div>{% endif %}
						{% if p.domain and p.domain.size > 0 %}<div style="margin-bottom: 0.25em;"><strong>Industry Domain{% if p.domain.size > 1 %}s{% endif %}:</strong> {% for d in p.domain %}{{ d }}{% unless forloop.last %}, {% endunless %}{% endfor %}</div>{% endif %}
						{% if p.project_type and p.project_type.size > 0 %}<div style="margin-bottom: 0.25em;"><strong>Project Type{% if p.project_type.size > 1 %}s{% endif %}:</strong> {% for t in p.project_type %}{{ t }}{% unless forloop.last %}, {% endunless %}{% endfor %}</div>{% endif %}
						{% if p.tags and p.tags.size > 0 %}<div><strong>Tags:</strong> {% for tag in p.tags %}{{ tag }}{% unless forloop.last %}, {% endunless %}{% endfor %}</div>{% endif %}
					</div>
					{% if p.external_links and p.external_links.size > 0 %}
					<div style="margin-top: 0.75em; font-size: 0.85em;">
						{% for link in p.external_links %}
						<a href="{{ link.url }}" target="_blank" rel="noopener" style="color: var(--text-secondary); text-decoration: underline; margin-right: 0.75em;">{{ link.label }}</a>
						{% endfor %}
					</div>
					{% endif %}
				</article>
				{% endfor %}
			</div>
		</div>
	</div>
</section>

<!-- Technologies & Tools section: comprehensive list for link checker compatibility -->
<section class="technologies-section" style="margin-top: 3em; padding-top: 2em; border-top: 1px solid rgba(255,255,255,0.1);">
	<h3 style="text-align: center; margin-bottom: 1.5em;"><u>Technologies & Tools</u></h3>
	<div class="row aln-center">
		<div class="col-10">
			{% assign all_platforms = '' | split: '' %}
			{% assign all_domains = '' | split: '' %}
			{% assign all_types = '' | split: '' %}
			{% for p in site.projects %}
				{% if p.platform and all_platforms contains p.platform == false %}{% assign all_platforms = all_platforms | push: p.platform %}{% endif %}
				{% if p.domain %}{% for d in p.domain %}{% if all_domains contains d == false %}{% assign all_domains = all_domains | push: d %}{% endif %}{% endfor %}{% endif %}
				{% if p.project_type %}{% for t in p.project_type %}{% if all_types contains t == false %}{% assign all_types = all_types | push: t %}{% endif %}{% endfor %}{% endif %}
			{% endfor %}
			<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2em;">
				<div>
					<h4 style="margin-bottom: 0.75em; font-size: 1em;">Platforms & Devices</h4>
					<ul style="margin: 0; padding-left: 1.5em; list-style: disc; color: var(--text-secondary);">
						{% for platform in all_platforms %}<li style="margin-bottom: 0.5em;">{{ platform }}</li>{% endfor %}
					</ul>
				</div>
				<div>
					<h4 style="margin-bottom: 0.75em; font-size: 1em;">Industry Domains</h4>
					<ul style="margin: 0; padding-left: 1.5em; list-style: disc; color: var(--text-secondary);">
						{% for domain in all_domains %}<li style="margin-bottom: 0.5em;">{{ domain }}</li>{% endfor %}
					</ul>
				</div>
				<div>
					<h4 style="margin-bottom: 0.75em; font-size: 1em;">Project Types</h4>
					<ul style="margin: 0; padding-left: 1.5em; list-style: disc; color: var(--text-secondary);">
						{% for type in all_types %}<li style="margin-bottom: 0.5em;">{{ type }}</li>{% endfor %}
					</ul>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- Project descriptions section: content excerpts for link checker compatibility -->
<section class="project-descriptions" style="margin-top: 3em; padding-top: 2em; border-top: 1px solid rgba(255,255,255,0.1);">
	<h3 style="text-align: center; margin-bottom: 1.5em;"><u>Project Descriptions</u></h3>
	<div class="row aln-center">
		<div class="col-10">
			{% for p in site.projects %}
			<article style="margin-bottom: 2.5em; padding-bottom: 2em; border-bottom: 1px solid rgba(255,255,255,0.08);">
				<h4 style="margin-bottom: 0.75em; font-size: 1.1em;">
					<a href="{{ p.url | relative_url }}" style="color: var(--text-primary); text-decoration: none;">{{ p.title }}</a>
				</h4>
				{% if p.summary %}
				<p style="margin: 0 0 0.75em 0; color: var(--text-secondary); line-height: 1.6; font-size: 0.95em;"><strong>Summary:</strong> {{ p.summary }}</p>
				{% endif %}
				{% if p.content and p.content.size > 50 %}
				<div style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9em;">
					{{ p.content | strip_html | truncatewords: 80 }}
				</div>
				{% endif %}
			</article>
			{% endfor %}
		</div>
	</div>
</section>

